<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Register</title>
    <link rel="icon" type="image/x-icon" href="ASSETS/favicon.ico">
    <style>
        /* Reset default styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* Container styles */
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        /* Header styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h2 {
            color: #333333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .decorative-line {
            width: 100%;
            height: 2px;
            background-color: #007bff;
            margin: 20px 0;
        }

        /* Form styles */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333333;
            font-weight: bold;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #dddddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="password"]:focus {
            border-color: #007bff;
            outline: none;
        }

        .submit-button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .submit-button:hover {
            background-color: #0056b3;
        }

        /* Switch form section styles */
        .switch-form {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dddddd;
        }

        .switch-form span {
            color: #666666;
        }

        .switch-form a {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
            margin-left: 5px;
        }

        .switch-form a:hover {
            text-decoration: underline;
        }

        /* Helper text styles */
        .helper-text {
            font-size: 12px;
            color: #666666;
            margin-top: 4px;
        }

        /* Agreement modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333333;
            font-size: 24px;
        }

        .agreement-text {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #dddddd;
            border-radius: 4px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-button {
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease;
        }

        .accept-button {
            background-color: #007bff;
            color: white;
        }

        .accept-button:hover {
            background-color: #0056b3;
        }

        .decline-button {
            background-color: #dc3545;
            color: white;
        }

        .decline-button:hover {
            background-color: #c82333;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: #333333;
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
        }

         /* Additional styles for the agreement text */
    .agreement-text {
        max-height: 70vh; /* Larger height for license */
        padding: 25px;
        font-size: 14px;
        line-height: 1.6;
        color: #333333;
    }

    .agreement-text h3 {
        color: #007bff;
        margin: 20px 0 10px 0;
        font-size: 16px;
    }

    .agreement-text p {
        margin-bottom: 15px;
    }

    .agreement-text strong {
        display: block;
        margin-bottom: 20px;
        font-size: 15px;
    }

    .agreement-text ul {
        margin: 10px 0;
        padding-left: 20px;
    }

    .agreement-text li {
        margin-bottom: 10px;
    }

    /* Make modal larger for license */
    .modal-content {
        max-width: 800px;
        margin: 5% auto;
        max-height: 90vh;
        overflow-y: auto;
    }

    /* Make header more prominent */
    .modal-header h2 {
        color: #007bff;
        font-size: 24px;
        margin-bottom: 15px;
    }
    </style>
</head>
<body>
    <!-- Main container -->
    <div class="container">
        <!-- Header section -->
        <div class="header">
            <h2 id="formHeader">Login</h2>
            <div class="decorative-line"></div>
        </div>

        <!-- Login form -->
        <form id="loginForm" action="INDEX-PHP/login.php" method="POST">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required autocomplete="username">
            </div>

            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required autocomplete="current-password">
            </div>

            <button type="submit" class="submit-button">Login</button>
        </form>

        <!-- Registration form -->
        <form id="registerForm" action="INDEX-PHP/register.php" method="POST" style="display: none;">
            <div class="form-group">
                <label for="registerUsername">Username:</label>
                <input type="text" id="registerUsername" name="username" required autocomplete="username">
                <div class="helper-text">*It must be the first name of an active worker*</div>
            </div>

            <div class="form-group">
                <label for="registerPassword">Password:</label>
                <input type="password" id="registerPassword" name="password" required autocomplete="new-password">
            </div>

            <button type="submit" class="submit-button">Register</button>
        </form>

        <!-- Form switch section -->
        <div class="switch-form">
            <span id="toggleText">Haven't registered?</span>
            <a href="#" id="toggleLink">Register</a>
        </div>
    </div>

    <div id="agreementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Proprietary License Agreement</h2>
            </div>
            <div class="agreement-text">
                <p><strong>Copyright (c) 2025 Johnson & Wales University (JWU) IT Field Services. All Rights Reserved.</strong></p>
                
                <h3>1. License Grant</h3>
                <p>This software is proprietary to Johnson & Wales University (JWU) IT Field Services ("Licensor"). By using this software, you (the "Licensee") are granted a limited, non-exclusive, non-transferable, and revocable license to use the software only if you are a current employee or authorized member of the IT Field Services department or the broader Johnson & Wales University (JWU) organization.</p>

                <h3>2. Restrictions</h3>
                <ul>
                    <li>You may not distribute, sublicense, sell, or share this software or any derivative works without explicit written permission from the Licensor.</li>
                    <li>You may not reverse engineer, decompile, or disassemble the software, except as permitted by applicable law.</li>
                    <li>This software may only be used within the scope of Johnson & Wales University's authorized operations and by members of the IT Field Services department or the greater JWU community.</li>
                </ul>

                <h3>3. Ownership</h3>
                <p>All rights, title, and interest in and to the software, including but not limited to any modifications, updates, or improvements, are owned solely by Johnson & Wales University (JWU) IT Field Services. This license does not grant you any ownership rights to the software or any intellectual property associated with it.</p>

                <h3>4. Termination</h3>
                <p>This license is effective until terminated. The license will terminate automatically without notice if you fail to comply with any provision of this agreement. Upon termination, you must immediately cease all use of the software and destroy any copies in your possession.</p>

                <h3>5. Disclaimer of Warranty</h3>
                <p>This software is provided "as-is," and the Licensor makes no warranties or representations, express or implied, regarding the software's functionality, accuracy, or reliability. The Licensor shall not be liable for any damages resulting from the use or inability to use the software.</p>

                <h3>6. Governing Law</h3>
                <p>This agreement shall be governed by and construed in accordance with the laws of the state of Rhode Island, without regard to its conflict of law principles.</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-button decline-button" onclick="declineAgreement()">Decline</button>
                <button class="modal-button accept-button" onclick="acceptAgreement()">Accept</button>
            </div>
        </div>
    </div>
    
    <!-- Notification element -->
    <div id="notification" class="notification"></div>

    <!-- JavaScript -->
    <script>
        // Get DOM elements
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const formHeader = document.getElementById('formHeader');
        const toggleText = document.getElementById('toggleText');
        const toggleLink = document.getElementById('toggleLink');
        const agreementModal = document.getElementById('agreementModal');
        const notification = document.getElementById('notification');

        // Store temporary user data
        let tempUserData = null;

        // Function to show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Function to toggle between login and register forms
        toggleLink.addEventListener('click', function(event) {
            event.preventDefault();
            
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                formHeader.textContent = 'Login';
                toggleText.textContent = 'Haven\'t registered?';
                toggleLink.textContent = 'Register';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                formHeader.textContent = 'Register';
                toggleText.textContent = 'Already registered?';
                toggleLink.textContent = 'Login';
            }
        });

        // Function to show agreement modal
        function showAgreementModal(userData) {
            tempUserData = userData;
            agreementModal.style.display = 'block';
        }

        // Function to accept agreement
        function acceptAgreement() {
            fetch('INDEX-PHP/update_agreement.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: tempUserData.user_id
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    agreementModal.style.display = 'none';
                    completeLogin(tempUserData);
                } else {
                    showNotification(data.message || 'Failed to update agreement status');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred. Please try again.');
            });
        }

        // Function to decline agreement
        function declineAgreement() {
            agreementModal.style.display = 'none';
            showNotification('You must accept the agreement to continue');
        }

        // Function to complete login
        function completeLogin(userData) {
            sessionStorage.setItem('isLoggedIn', 'true');
            sessionStorage.setItem('is_staff', userData.is_staff);
            sessionStorage.setItem('userName', userData.name);
            sessionStorage.setItem('campus', userData.campus);
            window.location.href = 'INDEX-HTML/main.html';
        }

        // Handle login form submission
        loginForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            const formData = new FormData(loginForm);

            fetch('INDEX-PHP/login.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.needs_agreement) {
                        showAgreementModal(data);
                    } else {
                        completeLogin(data);
                    }
                } else {
                    showNotification(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred. Please try again.');
            });
        });

        // Handle registration form submission
        registerForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            const formData = new FormData(registerForm);

            fetch('INDEX-PHP/register.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Registration successful! Please login.');
                    // Switch back to login form
                    loginForm.style.display = 'block';
                    registerForm.style.display = 'none';
                    formHeader.textContent = 'Login';
                    toggleText.textContent = 'Haven\'t registered?';
                    toggleLink.textContent = 'Register';
                } else {
                    showNotification(data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('An error occurred. Please try again.');
            });
        });
    </script>
</body>
</html>